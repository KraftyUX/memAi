# memAI Integration Rules

**memAI is mandatory** for persistent memory and intelligent resumption. Treat it as your memory bank — record everything significant, retrieve context instantly.

## Core Rule

**Record everything that matters. Never rely on the model’s internal context alone.**

## Always Record (Non-Negotiable)

| Category              | When to Record                              | Required Fields                           | Example Tags               |
| --------------------- | ------------------------------------------- | ----------------------------------------- | -------------------------- |
| `checkpoint`          | End of task, subtask, milestone             | phase, action, outcome, progress%         | milestone, completed       |
| `decision`            | Any technical/architectural choice          | decision, rationale, alternatives, impact | architecture, tech-choice  |
| `implementation`      | Significant code/feature added              | phase, action, context, outcome           | feature, refactor, api     |
| `issue`               | Problem encountered → immediately           | severity (P0–P3), description             | bug, blocker, config       |
| `user-interaction`    | Feedback, approval, clarification from user | action, context, outcome                  | approval, feedback         |
| `insight` / knowledge | Best practice, pattern, lesson learned      | topic, content, confidence, source        | best-practice, performance |
| `validation`          | Test suite results                          | testSuite, passed/failed, durationMs      | tests, ci                  |

### Issue Severity

- P0 → Critical (system down, security, data loss)
- P1 → High impact
- P2 → Medium (workaround exists)
- P3 → Low/cosmetic

## Session Lifecycle (Enforce Strictly)

### 1. Start of Every Session (MANDATORY)

**First action in every session:**

Call the `start_session` tool.

```json
{
  "goal": "Implement feature X"
}
```

This will provide you with the current context, active issues, and pending actions. **Read the output carefully.**

### 2. During Work (RECORD AS YOU GO)

**Record immediately when:**

- ✅ You complete a task or subtask (`record_memory`)
- ✅ You make any technical or architectural decision (`record_decision`)
- ✅ You encounter any issue or blocker (`record_memory` category: 'issue')
- ✅ You implement a significant feature or component (`record_memory`)

### 3. End of Every Session (MANDATORY)

**Final action before ending session:**

Call the `finish_session` tool.

```json
{
  "phase": "Current Phase Name",
  "status": "in-progress",
  "progressPercent": 50,
  "nextSteps": ["Next task 1", "Next task 2"]
}
```

This will automatically create a checkpoint and export a session report.

## Recording Best Practices (Do)

- ✅ **Be specific and outcome-oriented**: "Implemented OAuth 2.0 with PKCE flow" not "Fixed auth"
- ✅ **Always include why**: Explain rationale and alternatives considered
- ✅ **Use consistent tags**: lowercase, hyphenated (e.g., `frontend,auth,oauth`)
- ✅ **Link related memories**: Use `parentId` when applicable
- ✅ **Record immediately**: Don't wait until end of session
- ✅ **Include metrics**: LOC, time taken, performance improvements
- ✅ **Batch when possible**: But never skip important records
- ✅ **Always close**: Call `memai.close()` when done

## Never Do

- Vague entries (“fixed bug”)
- Skip decisions or issues
- Record trivial changes (formatting, typos)
- Forget `memai.close()`

## Quick Reference Commands

### Using npm Scripts (Recommended for Speed)

```bash
# Task completion
npm run memai:record task "Task Name" "Description" "completed"

# Subtask completion
npm run memai:record subtask "Subtask Name" "What was done" "completed"

# Decision
npm run memai:record decision "Decision" "Rationale" "Alternatives" "Impact"

# Issue
npm run memai:record issue "P1" "Description"

# Phase update
npm run memai:record phase "Phase Name" "in-progress" 50

# View status
npm run memai:stats
npm run memai:recent
npm run memai:briefing
npm run memai:verify
```

### Using JavaScript API (For Complex Recording)

```javascript
import Memai from 'memai';
const memai = new Memai();

// Decision
memai.recordDecision({
  decision: 'Use TanStack Query for data fetching',
  rationale: 'Better caching, automatic refetching, optimistic updates',
  alternatives: 'SWR (less features), Apollo Client (GraphQL only)',
  impact: 'Improved UX with instant feedback, reduced backend calls',
  reversible: true,
});

// Issue
const id = memai.recordIssue({
  severity: 'P1',
  description: 'TypeScript errors in DashboardView',
});
// Later: memai.resolveIssue(id, 'Fixed type definitions in src/types/tauri.ts');

// Implementation
memai.record({
  category: 'implementation',
  phase: 'Frontend Development',
  action: 'Created DashboardView component',
  context:
    'Built responsive dashboard with stats cards, recent prompts list, and quick refine input',
  reasoning: 'Dashboard is primary landing page - needs key metrics and quick actions',
  outcome: 'DashboardView.tsx (400 LOC) with real-time stats and virtual scrolling',
  tags: 'frontend,dashboard,react,tanstack-query',
});

// Knowledge
memai.addKnowledge({
  topic: 'TanStack Query Caching Strategy',
  content:
    'Use staleTime: 5 minutes for SENSES scores, cacheTime: 10 minutes. Invalidate on mutations.',
  confidence: 0.95,
  source: 'Implementation experience',
  tags: 'frontend,caching,tanstack-query,best-practice',
});

// Checkpoint
memai.createCheckpoint({
  phase: 'Frontend Development',
  status: 'in-progress',
  progressPercent: 30,
  pendingActions: ['Task 13: Prompt Library View', 'Task 14: Refinement Workflow'],
  blockers: [],
});

// Always close
memai.close();
```

## Query Examples (Use Frequently)

```javascript
import Memai from 'memai';
const memai = new Memai();

// Get recent work
const recent = memai.getRecentMemories(20);

// Search by tag
const authWork = memai.searchByTag('authentication');

// Get active issues
const issues = memai.getActiveIssues();

// Get phase context
const context = memai.getPhaseContext('Frontend Development');

// Get statistics
const stats = memai.getStats();
console.log(`Total: ${stats.totalMemories} memories, ${stats.totalDecisions} decisions`);

// Generate briefing
const briefing = memai.generateBriefing({ since: Date.now() - 86400000 }); // last 24h
console.log(`Phase: ${briefing.summary.currentPhase}`);
console.log(`Progress: ${briefing.summary.currentProgress}%`);

memai.close();
```

## Verification and Troubleshooting

### Verify memAI is Working

```bash
# Run verification script
npm run memai:verify

# Check stats
npm run memai:stats

# View recent memories
npm run memai:recent

# Open dashboard
npm run memai:dashboard    # http://localhost:3030
```

### Common Issues

**Problem**: "memAI not recording"
**Solution**: Run `npm run memai:verify` to diagnose

**Problem**: "Database locked"
**Solution**: Ensure you called `memai.close()` in previous session

**Problem**: "Can't find recent work"
**Solution**: Use `npm run memai:briefing` to see last 24h summary

## Resources

- **Quick Reference**: `.memai/QUICK_REFERENCE.md`
- **Full Guide**: `.memai/README.md`
- **Verification Report**: `.memai/VERIFICATION.md`
- **Session Reports**: `docs/sessions/`
- **Scripts**: `scripts/record-task.js`, `scripts/verify-memai.js`
